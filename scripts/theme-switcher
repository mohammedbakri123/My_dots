#!/bin/bash
# Theme Switcher - Toggle between light and dark themes

CONFIG_DIR="$HOME/.config"
CACHE_DIR="$HOME/.cache"
THEME_FILE="$CACHE_DIR/current-theme"

# Detect current theme
get_current_theme() {
    if [ -f "$THEME_FILE" ]; then
        cat "$THEME_FILE"
    else
        echo "dark"
    fi
}

# Set GTK theme
set_gtk_theme() {
    local theme="$1"
    
    if [ "$theme" = "light" ]; then
        gsettings set org.gnome.desktop.interface gtk-theme "Adwaita"
        gsettings set org.gnome.desktop.interface color-scheme "prefer-light"
    else
        gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark"
        gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"
    fi
}

# Set kitty theme
set_kitty_theme() {
    local theme="$1"
    
    if [ "$theme" = "light" ]; then
        kitty +kitten themes --reload-in=all "Atom One Light"
    else
        kitty +kitten themes --reload-in=all "Catppuccin-Mocha"
    fi
}

# Set hyprland borders
set_hyprland_theme() {
    local theme="$1"
    
    if [ "$theme" = "light" ]; then
        hyprctl keyword general:col.active_border "rgba(89b4faff)"
        hyprctl keyword general:col.inactive_border "rgba(5c5f77ff)"
        hyprctl keyword decoration:shadow:color "rgba(1a1a1a40)"
    else
        hyprctl keyword general:col.active_border "rgba(f5c2e7ff)"
        hyprctl keyword general:col.inactive_border "rgba(45475aff)"
        hyprctl keyword decoration:shadow:color "rgba(1a1a1aee)"
    fi
}

# Toggle theme
toggle_theme() {
    local current=$(get_current_theme)
    local new_theme
    
    if [ "$current" = "dark" ]; then
        new_theme="light"
    else
        new_theme="dark"
    fi
    
    # Save theme preference
    echo "$new_theme" > "$THEME_FILE"
    
    # Apply theme
    set_gtk_theme "$new_theme"
    set_kitty_theme "$new_theme"
    set_hyprland_theme "$new_theme"
    
    notify-send "Theme switched to $new_theme mode"
}

# Set specific theme
set_theme() {
    local theme="$1"
    
    if [ "$theme" != "light" ] && [ "$theme" != "dark" ]; then
        echo "Invalid theme: $theme (use: light or dark)"
        exit 1
    fi
    
    echo "$theme" > "$THEME_FILE"
    set_gtk_theme "$theme"
    set_kitty_theme "$theme"
    set_hyprland_theme "$theme"
    
    notify-send "Theme set to $theme mode"
}

# Show current theme
show_theme() {
    local current=$(get_current_theme)
    echo "Current theme: $current"
}

# Main
case "${1:-toggle}" in
    toggle)
        toggle_theme
        ;;
    light)
        set_theme "light"
        ;;
    dark)
        set_theme "dark"
        ;;
    status)
        show_theme
        ;;
    *)
        echo "Usage: $0 {toggle|light|dark|status}"
        exit 1
        ;;
esac
